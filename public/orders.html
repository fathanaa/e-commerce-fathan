<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesanan Saya</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        main {
            flex: 1 0 auto;
        }
        footer {
            flex-shrink: 0;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Header -->
    <header class="bg-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <button onclick="goBack()" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <h1 class="text-xl font-bold">Pesanan Saya</h1>
            <div class="flex items-center space-x-4">
                <a href="about.html" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 focus:outline-none">Profil Saya</a>
                <a href="index.html" onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 focus:outline-none">Log Out</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-6 bg-white shadow-md mt-4 rounded-lg">
        <div class="flex flex-col gap-6">
            <h2 class="text-2xl font-semibold text-gray-800">Riwayat Pesanan</h2>
            <div id="orders-list" class="space-y-4">
                <!-- Orders will be populated dynamically -->
            </div>
            <p id="no-orders" class="text-gray-500 text-center hidden">Belum ada pesanan.</p>
            <div class="flex justify-end mt-4">
                <button id="clear-orders-button" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md" onclick="clearOrders()">Clear All Orders</button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-4">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <!-- Logo dan Deskripsi -->
            <div class="mb-4 md:mb-0">
                <h2 class="text-3xl font-bold text-yellow-400">GoldenCart</h2>
                <p class="text-sm mt-2">
                    GoldenCart adalah platform digital yang dirancang untuk mempromosikan dan menjual berbagai jenis jam tangan, baik untuk pria maupun wanita. Website ini bertujuan memberikan pengalaman belanja online yang informatif, elegan, dan modern, serta merepresentasikan citra brand yang premium.
                </p>
                <p class="text-xs mt-2">Â© 2025 GoldenCart. Semua Hak Cipta</p>
            </div>
    
            <!-- Informasi -->
            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-8 text-sm">
                <div>
                    <h3 class="font-semibold mb-2">Information</h3>
                    <ul class="space-y-1">
                        <li><a href="#" class="hover:text-yellow-400">Contact Us</a></li>
                        <li><a href="#" class="hover:text-yellow-400">Terms & Condition</a></li>
                        <li><a href="#" class="hover:text-yellow-400">Join The Crew</a></li>
                        <li><a href="#" class="hover:text-yellow-400">Community</a></li>
                    </ul>
                </div>
    
                <!-- Ikuti Kami -->
                <div>
                    <h3 class="font-semibold mb-2">Ikuti Kami</h3>
                    <div class="flex space-x-2">
                        <a href="#" class="text-white hover:text-yellow-400">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm0 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0 6c-2.757 0-5 2.243-5 5s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5zm0 2c1.656 0 3 1.344 3 3s-1.344 3-3 3-3-1.344-3-3 1.344-3 3-3z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-white hover:text-yellow-400">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-2.717 0-4.92 2.203-4.92 4.917 0 .386.045.762.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.732-.666 1.585-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.396 0-.788-.023-1.175-.068 2.187 1.405 4.787 2.224 7.574 2.224 9.055 0 14.008-7.496 14.008-13.985 0-.21 0-.42-.015-.63.962-.695 1.8-1.562 2.457-2.549z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-white hover:text-yellow-400">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM10 15.5v-7l6 3.5-6 3.5z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Fetch products from Fake Store API and cache in localStorage
        async function fetchProducts() {
            const cacheKey = 'fakeStoreProducts';
            const cacheExpiration = 24 * 60 * 60 * 1000; // Cache for 24 hours
            const cachedData = localStorage.getItem(cacheKey);
            const cachedTimestamp = localStorage.getItem(`${cacheKey}_timestamp`);
            const now = Date.now();

            // Return cached data if it exists and isn't expired
            if (cachedData && cachedTimestamp && (now - parseInt(cachedTimestamp) < cacheExpiration)) {
                return JSON.parse(cachedData);
            }

            try {
                const response = await fetch('https://fakestoreapi.com/products');
                if (!response.ok) throw new Error('Failed to fetch products');
                const products = await response.json();
                // Cache the data
                localStorage.setItem(cacheKey, JSON.stringify(products));
                localStorage.setItem(`${cacheKey}_timestamp`, now.toString());
                return products;
            } catch (error) {
                console.error('Error fetching products:', error);
                return [];
            }
        }

        // Find matching product image by item name
        function findProductImage(products, itemName) {
            if (!itemName || !products) return null;
            const lowerItemName = itemName.toLowerCase();
            const product = products.find(p => p.title.toLowerCase().includes(lowerItemName));
            return product ? product.image : null;
        }

        // Load orders from localStorage
        async function loadOrders() {
            const ordersList = document.getElementById("orders-list");
            const noOrdersMessage = document.getElementById("no-orders");
            const clearOrdersButton = document.getElementById("clear-orders-button");
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const products = await fetchProducts();

            ordersList.innerHTML = ''; // Clear existing content

            if (orders.length === 0) {
                noOrdersMessage.classList.remove("hidden");
                clearOrdersButton.classList.add("hidden");
                return;
            }

            noOrdersMessage.classList.add("hidden");
            clearOrdersButton.classList.remove("hidden");

            orders.forEach(order => {
                const orderCard = document.createElement("div");
                orderCard.className = "border rounded-lg p-4 bg-gray-50";
                orderCard.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-lg font-semibold text-gray-700">Pesanan #${order.id}</h3>
                        <span class="text-sm text-gray-500">${order.date}</span>
                    </div>
                    <div class="mb-2">
                        ${order.items.map(item => {
                            const imageUrl = findProductImage(products, item.name) || 'https://via.placeholder.com/96';
                            return `
                                <div class="flex items-center justify-between text-sm text-gray-600 mb-2">
                                    <div class="flex items-center space-x-4">
                                        <img src="${imageUrl}" alt="${item.name}" class="w-24 h-24 object-contain rounded">
                                        <div>
                                            <span>${item.name} x${item.quantity}</span>
                                            <p class="text-sm text-gray-600">Harga Satuan: $${item.price.toFixed(2)}</p>
                                        </div>
                                    </div>
                                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                                </div>
                            `;
                        }).join("")}
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-semibold text-gray-700">Total: $${order.total.toFixed(2)}</span>
                        <span class="text-sm px-2 py-1 rounded ${order.status === 'Dikirim' ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'}">${order.status}</span>
                    </div>
                `;
                ordersList.appendChild(orderCard);
            });
        }

        // Clear all orders
        function clearOrders() {
            if (confirm("Apakah Anda yakin ingin menghapus semua pesanan?")) {
                localStorage.removeItem('orders');
                loadOrders();
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem("userData");
            window.location.href = "login.html";
        }

        // Navigation
        function goBack() {
            window.history.back();
        }

        // Load orders on page load
        window.onload = async function() {
            await loadOrders();
        };
    </script>
</body>
</html>